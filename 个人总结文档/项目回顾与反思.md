# DreamAIChat · 项目回顾与反思（项目层面）

> 作者：邢浩哲  
> 视角：项目 Owner / 客户端主程

---

## 1. 项目起点：从“能跑起来”到“敢交付”

刚开始接触 chatbot 这个题目时，我的目标非常朴素：  
> 先把“登录 → 聊天 → 历史”这一条链路跑通，再谈体验和工程化。

在这个阶段，我更多关注的是：
- Android Studio 环境搭建、Gradle 依赖问题排查；  
- 基于 Retrofit + OkHttp 打通一个最小可运行的聊天接口；  
- 使用 Room 存储本地会话和消息，保证重启后看得到历史。

这一阶段的特点是“能跑”，但还谈不上“好用”和“好维护”。

---



## 2. 架构与代码层面的关键决策

### 2.1 前端架构：MVVM + 登陆入口 MVI

在项目中，我刻意保留了早期训练营提供的 MVI 登录模块，同时将核心功能（聊天、历史、个人中心）迁移到更贴近官方推荐的 MVVM 架构上：
- 登录：继续使用 `BaseViewModel + Intent + State` 的单向数据流，保持状态清晰可追踪；  
- 聊天 / 历史 / Profile：使用 `AndroidViewModel + LiveData + Repository`，方便与 Room/Retrofit 集成。

这项决策的好处：
- 避免了“一开始就大改”带来的风险，渐进式演进；  
- 兼顾了训练营提供的教学样例和我自己的工程化实践；
- 也让我在实践中对比体验了 MVI 与 MVVM 在 Android 场景下的优劣。

### 2.2 数据层：本地优先 + 远程同步

我把数据流明确拆成两层：
- **本地**：Room 负责用户、会话、消息的持久化；  
- **远程**：Spring Boot 后端负责真实的登录与大模型调用。

核心经验：
- 所有“可能失败的远程调用”（模型回复）在客户端都有本地兜底（例如演示模式文案）；  
- 历史会话列表始终以本地数据库为准，避免因为网络波动导致列表残缺。

---



## 3. 典型问题与修复过程

### 3.1 历史记录丢失：一次“数据库级联删除”的教训

在调试“退出登录 → 重新登录”时，我发现一个严重问题：  
> 同一账号重新登录后，历史记录全部消失，但昵称等 Session 信息仍然保留。

排查过程：
1. 检查 SessionManager：只清除了 token / userId，没有主动清 Room；  
2. 检查 Room：`users` 表被使用 `INSERT OR REPLACE` 更新；  
3. 检查外键：`conversations` / `messages` 外键指向 `users`，并配置了 `ON DELETE CASCADE`。

最终结论：
- 登录时的 `REPLACE` 实际上是“先删再插”，触发了外键级联删除，导致所有历史会话和消息全部被清空。

修复方式：
- 对已有账号不再执行 `REPLACE`，改为 `UPDATE` 原有记录；  
- 仅在账号首次出现时才 `INSERT`；  
- 在《故障排查及解决文档》中完整记录该问题的根因和修复方案。

这件事让我再次意识到：
> “合理”的数据库配置如果缺乏全局视角，同样会成为隐蔽的杀伤武器。

### 3.2 UI 与交互细节：从“能点”到“好用”

几个印象深刻的例子：
- 聊天输入区的“发送”和“图片”按钮从 MaterialButton 改为 ImageButton，与 Toolbar 图标视觉统一；  
- 快捷 Chip 与附件预览的布局被重新抽象为 `action_container`，避免 RecyclerView 高度被挤压为 0；  
- 空态历史页的“开始对话”按钮从无效点击改为真正创建新会话并跳转 Chat。

这些都是用户一上手就能感知到的细节，看似简单，但背后是多轮真机调试和 UI 调整。

---



## 4. 文档与工程化的收获

我强制自己在项目开发过程中同步维护多类文档, 如：
- 《架构设计白皮书》：记录整体分层、架构模式和关键模块；  
- 《部署指南》：从本地到云端，从 API Key 到诊断接口，一步步写清楚；  
- 《故障排查及解决文档》：每个典型 bug 都写明“错误表现 → 根因 → 修复 → 预防”；  
- 《AI 指令工程实践报告》：站在 Prompt Engineer 的角度，总结人机协作的套路。

这种“文档先行/同步”的做法带来的好处：
- 当我回头看一个月前的决策时，不需要再去翻代码猜动机；  
- 如果以后有同学接手这个项目，只需从 README 和部署指南开始，很快就能跑起来；  
- 在与 AI 协作时，能直接引用现有文档作为 Prompt 上下文，减少重复解释。

---



## 5. 项目层面的反思与改进方向

1. **需求收敛节奏**  
   - 早期我对功能想象较多（包括模型路由单独界面、更多复杂图谱可视化），后期结合时间和训练营目标做了收敛，这个判断是正确的；  
   - 但如果一开始就用“Must/Should/Could”分层，项目节奏会更从容。

2. **测试与自动化不足**  
   - 目前主要依赖手工测试 + Logcat 诊断；  
   - 后续如果继续演进，应补充关键用例的单元测试 / 集成测试（特别是 Room 与网络层）。

3. **云端部署起步略晚**  
   - 在后期才系统性考虑“后端上云 + 公网访问”的方案；  
   - 如果在项目中期就进行这一步，后续的联调和演示会更加顺畅。

---



## 6. 总结

从一个简单的想法，到可以被他人安装 APK、连上后端体验的完整产品，这个过程让我真正体会到：
- “工程化”不是大词，而是体现在每一个小细节：数据表设计、错误处理、日志、文档；  
- 与 AI 协作不是“把键盘交给它”，而是用高质量 Prompt 和严谨验收，放大自己的能力；  
- 一个看似“小题目”的训练营项目，只要用心设计和打磨，也可以成为一份完整的作品集。

接下来，我会在现有基础上，继续按照“功能迭代路线图”推进，同时尝试把字节训练营中得到的经验迁移到下一个项目中!

