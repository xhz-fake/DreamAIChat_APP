# DreamAIChat_APP 部署文档



## 1. 环境要求

### 1.1 开发环境

- **操作系统**: Windows 10/11, macOS, 或 Linux
- **JDK**: JDK 11 或更高版本
- **Android Studio**: Arctic Fox (2020.3.1) 或更高版本
- **Gradle**: 8.0 或更高版本（项目已包含 Gradle Wrapper）
- **Android SDK**: API 21 (Android 5.0) 或更高版本

### 1.2 硬件要求

- **内存**: 至少 8GB RAM（推荐 16GB）
- **存储空间**: 至少 10GB 可用空间
- **网络**: 需要稳定的网络连接以下载依赖



## 2. 项目结构图

```
DreamAIChat_APP/
├── app/                          # 应用模块
│   ├── src/
│   │   ├── main/
│   │   │   ├── java/            # Java 源代码
│   │   │   │   └── com/example/dreamaichat_app/
│   │   │   │       ├── data/    # 数据层
│   │   │   │       ├── domain/ # 领域层
│   │   │   │       ├── mvi/    # MVI 架构基础
│   │   │   │       ├── presentation/ # 表现层
│   │   │   │       └── ui/     # UI 层
│   │   │   ├── res/            # 资源文件
│   │   │   └── AndroidManifest.xml
│   │   └── test/               # 测试代码
│   └── build.gradle.kts        # 模块构建配置
├── gradle/                     # Gradle 配置
│   └── libs.versions.toml     # 依赖版本管理
├── build.gradle.kts            # 项目构建配置
├── settings.gradle.kts         # 项目设置
└── gradlew                     # Gradle Wrapper (Unix)
```



## 3. 安装步骤 (保姆级)

### 3.1 克隆项目 (可选)

```bash
# 如果项目在 Git 仓库中
git clone <repository-url>
cd DreamAIChat_APP
```

### 3.2 配置 Android Studio

1. **打开项目**
   - 启动 Android Studio
   - 选择 `File` → `Open`
   - 选择项目根目录

2. **同步 Gradle**
   - Android Studio 会自动检测项目并提示同步
   - 点击 `Sync Now` 或等待自动同步完成
   - 首次同步可能需要较长时间（下载依赖）

3. **配置 SDK**
   - 打开 `File` → `Project Structure` → `SDK Location`
   - 确保已安装 Android SDK Platform 21 或更高版本
   - 确保已安装 Android SDK Build-Tools

### 3.3 配置 API 地址

#### 3.3.1 什么是 API 地址？

API 地址（也叫 Base URL）是我们的后端服务器地址。当应用需要获取数据或发送数据时，会向这个地址发送 HTTP 请求。

**简单理解**：

- 就像你家的地址一样，API 地址告诉应用"去哪里找数据"
- 例如：`https://api.example.com/` 就是服务器的地址
- 具体的接口（如登录、发送消息）会在这个地址后面添加路径

#### 3.3.2 配置步骤

**步骤 1：找到配置文件**

1. 在 Android Studio 左侧的 `Project` 面板中，找到以下路径：
   ```
   app → src → main → java → com → example → dreamaichat_app → data → remote → RetrofitClient.java
   ```
2. 双击打开 `RetrofitClient.java` 文件

**步骤 2：修改 BASE_URL**

在文件中找到这一行（大约在第 30 行左右）：
```java
private static final String BASE_URL = "https://api.example.com/";
```

将 `https://api.example.com/` 替换为你的实际 API 地址。

**重要提示**：

- ✅ 地址必须以 `http://` 或 `https://` 开头
- ✅ 地址末尾必须有斜杠 `/`
- ✅ 不要包含具体的接口路径（如 `/auth/login`），只写基础地址
- ❌ 错误示例：`api.example.com`（缺少协议）
- ❌ 错误示例：`https://api.example.com`（缺少末尾斜杠）
- ✅ 正确示例：`https://api.example.com/`

#### 3.3.3 不同场景的配置方法

**场景 1：使用本地开发服务器**

如果你在本地运行后端服务器（如使用 Spring Boot、Node.js 等）：

```java
// 如果使用 Android 模拟器，使用 10.0.2.2 代替 localhost
private static final String BASE_URL = "http://10.0.2.2:8081/";

// 如果使用真机调试，使用电脑的 IP 地址（在 cmd 中输入 ipconfig 查看）
private static final String BASE_URL = "http://192.168.1.100:8081/";
```

**如何查看电脑 IP 地址**：
- Windows：打开命令提示符（cmd），输入 `ipconfig`，找到 "IPv4 地址"
- Mac/Linux：打开终端，输入 `ifconfig`，找到 "inet" 地址

**场景 2：使用测试服务器**

如果你有测试环境的服务器地址：

```java
private static final String BASE_URL = "https://test-api.yourcompany.com/";
```

**场景 3：使用生产服务器**

正式发布时使用：

```java
private static final String BASE_URL = "https://api.yourcompany.com/";
```

**场景 4：暂时没有后端服务器（开发测试）**

如果你还没有后端服务器，可以：

1. **使用模拟数据**（推荐用于 UI 开发）
   - 暂时不修改 BASE_URL
   - 在 `LoginUseCase` 和 `SendMessageUseCase` 中返回模拟数据
   - 这样可以先完成界面开发

2. **使用公共测试 API**
   - 可以使用一些免费的测试 API 服务
   - 例如：`https://jsonplaceholder.typicode.com/`（仅用于测试，不是真实功能）

#### 3.3.4 配置示例

**完整配置示例**：

```java
public class RetrofitClient {
    // 开发环境 - 本地服务器
    private static final String BASE_URL = "http://10.0.2.2:8081/";
    
    // 或者测试环境
    // private static final String BASE_URL = "https://test-api.example.com/";
    
    // 或者生产环境
    // private static final String BASE_URL = "https://api.example.com/";
    
    // ... 其他代码
}
```

#### 3.3.5 如何验证配置是否正确？

**方法 1：查看日志**

1. 运行应用
2. 打开 Android Studio 底部的 `Logcat` 面板
3. 过滤标签：输入 `OkHttp` 或 `Retrofit`
4. 如果看到类似以下的日志，说明配置成功：
   ```
   D/OkHttp: --> POST https://api.example.com/auth/login
   D/OkHttp: Content-Type: application/json
   ```

**方法 2：测试登录功能**

1. 在应用中输入账号密码，点击登录
2. 查看 Logcat：
   - 如果看到网络请求日志，说明配置正确
   - 如果看到连接错误（如 "Failed to connect"），检查：
     - API 地址是否正确
     - 服务器是否运行
     - 网络是否连接

#### 3.3.6 常见问题解决方案

**问题 1：连接失败（Connection refused）**

**原因**：
- API 地址错误
- 服务器未运行
- 防火墙阻止连接

**解决方法**：
1. 检查 API 地址是否正确（包括协议、端口号）
2. 确认后端服务器正在运行
3. 检查网络连接

**问题 2：404 Not Found**

**原因**：
- API 路径错误
- 服务器上没有对应的接口

**解决方法**：
1. 检查 `ApiService.java` 中的接口路径是否正确
2. 与后端开发人员确认接口路径

**问题 3：SSL 证书错误（仅 HTTPS）**

**原因**：
- 使用了自签名证书
- 证书过期

**解决方法**（仅开发环境）：
- 暂时使用 HTTP 协议（不推荐生产环境）
- 或配置信任所有证书（仅用于开发测试）

#### 3.3.7 配置认证 Token（可选）

如果你的 API 需要认证 Token，需要在登录成功后保存 Token，然后在后续请求中使用。

**当前实现**：
- Token 在 `SendMessageUseCase` 中使用
- 登录成功后，Token 应该保存在 `SharedPreferences` 或数据库中
- 后续请求会自动带上 Token

**如何配置**（如果 Token 管理还未实现）：
1. 暂时可以在 `SendMessageUseCase` 中硬编码测试 Token
2. 后续会实现完整的 Token 管理机制

#### 3.3.8 下一步

配置完 API 地址后：
1. ✅ 保存文件（Ctrl+S 或 Cmd+S）
2. ✅ 同步项目（点击 Android Studio 顶部的 "Sync Now"）
3. ✅ 运行应用测试网络连接
4. ✅ 查看 Logcat 确认请求是否发送成功



## 4. Spring Boot 后端部署

Android 客户端已经不再依赖模拟数据，`DreamAIChat_backend` 提供真实的登录、对话、会话列表等接口。本节给出最小可运行版本的搭建步骤：

### 4.1 环境要求

- JDK 17（建议使用 Temurin/OpenJDK）
- Gradle 8+（项目自带 Wrapper，可直接运行 `./gradlew`）
- 可访问外网，用于请求 Doubao / DeepSeek API

### 4.2 在 IDEA 中启动后端

**步骤 1：创建运行配置**

1. 在 IDEA 中打开项目
2. 找到主类：`DreamAiChatBackendApplication.kt`
   - 路径：`DreamAIChat_backend/src/main/kotlin/com/dreamaichat/backend/DreamAiChatBackendApplication.kt`
3. 右键点击主类文件，选择 **"Run 'DreamAiChatBackendApplication'"**
   - 或者点击主类文件左侧的绿色三角形 ▶️

**步骤 2：配置运行参数**

1. 点击 IDEA 顶部工具栏的 **"Run"** → **"Edit Configurations..."**
2. 在左侧找到 **"DreamAiChatBackendApplication"** 配置
3. 在右侧配置面板中：

   **a. 设置 Active profiles（重要！）**
   
   - 找到 **"Active profiles"** 字段
   - 输入：`local`
   - 或者在 **"VM options"** 中添加：`-Dspring.profiles.active=local`
   
   **b. 设置环境变量**
   
   - 找到 **"Environment variables"**
   - 添加以下环境变量（如果使用系统环境变量，可以跳过此步）：
     ```
     DEEPSEEK_API_KEY=sk-你的密钥
     DOUBAO_API_KEY=你的豆包密钥
     ```

4. 点击 **"Apply"** → **"OK"** 保存配置

**步骤 3：启动后端**

1. 点击 IDEA 顶部工具栏的绿色运行按钮 ▶️
2. 或者按快捷键：`Shift + F10`
3. 查看控制台输出，应该看到：
   ```
   The following profiles are active: local
   Tomcat started on port 8081
   Started DreamAiChatBackendApplication in Xs
   ```

### 4.3 配置 API Key（系统环境变量方式）

**步骤 1：设置系统环境变量**

1. 按 `Win + R`，输入 `sysdm.cpl`，回车
2. 点击 **"高级"** → **"环境变量"**
3. 在 **"用户变量"** 区域点击 **"新建"**：
   - 变量名：`DEEPSEEK_API_KEY`
   - 变量值：你的 DeepSeek API Key（格式：`sk-xxxxx`）
4. 再次点击 **"新建"**：
   - 变量名：`DOUBAO_API_KEY`
   - 变量值：你的豆包 API Key
5. 点击 **"确定"** 保存

**步骤 2：在 IDEA 运行配置中添加环境变量**

1. 在 IDEA 运行配置的 **"Environment variables"** 中添加：
   ```
   DEEPSEEK_API_KEY=${DEEPSEEK_API_KEY}
   DOUBAO_API_KEY=${DOUBAO_API_KEY}
   ```
2. 或者直接填写实际值（不推荐，因为会保存在配置文件中）

**步骤 3：重启后端服务**

1. 停止当前运行的后端（如果正在运行）
2. 在 IDEA 中重新启动后端
3. 后端会自动从系统环境变量读取 API Key

### 4.4 可用接口

| 方法 | 路径 | 说明 |
| --- | --- | --- |
| `POST /api/auth/register` | 创建账号（account + password） |
| `POST /api/auth/login` | 登录，返回 `token` 与 `userId` |
| `GET /api/chat/conversations` | 获取当前用户的会话列表（需要 `Authorization: Bearer <token>`） |
| `POST /api/chat/send` | 向所选模型发送消息，同时写入会话与消息表 |

所有接口都返回统一的 `ApiResponse<T>`，Android 侧已经适配。

### 4.5 与 Android 联调

1. 启动后端（默认端口 8081）
2. 确保模拟器可访问主机，Android 端 `RetrofitClient` 已设置 `http://10.0.2.2:8081/`
3. 在 App 内点击注册或登录，成功后会将 Token 写入 `SessionManager`
4. 聊天/历史页面即可实时调用后端

> 生产部署时可将 `DreamAIChat_backend` 打包为 Jar：`./gradlew bootJar`，上传至服务器后运行 `java -jar build/libs/DreamAIChat_backend-0.1.0.jar`，并通过 `application.yml` 或环境变量覆盖端口、数据库等配置。

### 4.6 大模型 API Key 申请与配置

#### 4.6.1 申请 API Key

**DeepSeek API Key**：
1. 访问 https://platform.deepseek.com/
2. 注册/登录账号
3. 进入 **"API Keys"** 页面
4. 点击 **"Create API Key"**，复制生成的 Key（格式：`sk-xxxxx`）

**豆包 API Key**：
1. 访问 https://www.volcengine.com/
2. 注册/登录账号
3. 搜索并开通 **"豆包"** 服务
4. 在 **"API 密钥管理"** 中创建密钥，复制生成的 Key

#### 4.6.2 配置系统环境变量

1. 按 `Win + R`，输入 `sysdm.cpl`，回车
2. 点击 **"高级"** → **"环境变量"**
3. 在 **"用户变量"** 区域点击 **"新建"**：
   - 变量名：`DEEPSEEK_API_KEY`，变量值：你的 DeepSeek API Key
   - 变量名：`DOUBAO_API_KEY`，变量值：你的豆包 API Key
4. 点击 **"确定"** 保存
5. **重要**：关闭所有已打开的终端/IDEA 窗口，重新打开 IDEA

#### 4.6.3 在 IDEA 中配置环境变量

1. 在 IDEA 运行配置的 **"Environment variables"** 中添加：
   ```
   DEEPSEEK_API_KEY=${DEEPSEEK_API_KEY}
   DOUBAO_API_KEY=${DOUBAO_API_KEY}
   ```
2. 或者直接填写实际值（不推荐）

#### 4.6.4 验证配置

1. 在 IDEA 中启动后端
2. 在 Android 应用中发送测试消息
3. 如果收到真实的 AI 回复（不是演示模式），说明配置成功 ✅

**注意**：
- 模型名称必须与火山引擎控制台中的名称完全一致（豆包：`doubao-seed-1-6-vision-250815`）
- 如果修改模型名称，需要确保新模型在你的账户中可用
- 详细问题排查请参考 `vibe_coding实践文档/故障排查及解决文档.md`

---



## 5. 后端上云部署（以火山引擎为例，选做）

> 本节适合希望让“手机 + APK 在任意网络下都能访问后端”。  
> 如果只在本地网络内测试，可以先跳过这一节。

### 5.1 整体思路

1. 在火山引擎创建一台云服务器（公网 IP）；  
2. 在云服务器上安装 JDK / Gradle（或仅 JDK，使用项目自带 Wrapper）；  
3. 把 `DreamAIChat_backend` 工程上传到云服务器；  
4. 在云服务器上启动 Spring Boot 后端，并开放 HTTP 端口（例如 8082 或 80）；  
5. 将 Android 端 `BASE_URL` 改为云服务器的公网地址，例如：`http://<你的云服务器IP>:8082/`；  
6. 重新生成 APK，老师只要装 APK + 能联网，就可以直接体验真实在线版本。

### 5.2 在火山引擎创建云服务器

> 实际界面可能会更新，以下步骤以“典型云厂商”的控制台为参考，关键是：创建实例 → 记住公网 IP → 打开安全组端口。

1. 登录火山引擎控制台，进入 **云服务器 ECS** 管理页；  
2. 创建实例（推荐）：
   - 地区：靠近你和评审老师的地区（比如华北、华东）；  
   - 规格：1 核 2G / 2 核 4G 即可；  
   - 操作系统：Ubuntu 20.04 或 CentOS 7 均可；  
   - 公网带宽：1~5 Mbps 即可满足测试；  
3. 创建完成后，在控制台查看该实例的：
   - 公网 IP，例如：`123.45.67.89`；  
   - 登录方式（用户名/密码 或 SSH Key）。  
4. 在实例“安全组”中，放通后端端口：  
   - 新建规则：入方向允许 TCP `8082`（或你准备使用的端口）对 0.0.0.0/0 开放；  
   - 如果你打算将后端跑在 80 端口，可以直接放通 80。

### 5.3 连接云服务器并准备运行环境

1. 使用 SSH 连接：
   ```bash
   ssh root@123.45.67.89
   ```
2. 安装 JDK（以 Ubuntu 为例）：
   ```bash
   apt update
   apt install -y openjdk-17-jdk
   java -version   # 确认安装成功
   ```
3. （可选）安装 Git：
   ```bash
   apt install -y git
   ```

### 5.4 上传后端代码到云服务器

有两种常见方式：

- **方式一：Git 仓库**  
  1. 在本地将 `DreamAIChat_backend` 推送到你自己的私有 Git 仓库（不要包含 `application-local.yml` 和 API Key）；  
  2. 在云服务器上：
     ```bash
     git clone <你的仓库地址>
     cd DreamAIChat_backend
     ```

- **方式二：直接打包上传（推荐新手使用）**  

  以下提供三种方法，从最简单到稍复杂，你可以选择最适合的：

  **方式 2A：使用 Windows 图形界面（最简单，推荐新手）**

  1. **在本地压缩后端目录**
     
     假设我们的后端目录在：`D:\ProgramFiles\CodeProjects\Android\projects\DreamAIChat\DreamAIChat_APP\DreamAIChat_backend`
     
     **方法一：压缩整个文件夹（推荐）**
     - 打开文件资源管理器（按 `Win + E`）
     - 导航到 `D:\ProgramFiles\CodeProjects\Android\projects\DreamAIChat\DreamAIChat_APP`
     - 找到 `DreamAIChat_backend` 文件夹
     - 右键点击 `DreamAIChat_backend` 文件夹
     - 选择 **"发送到"** → **"压缩(zipped)文件夹"**
     - 等待压缩完成，会在同一目录下生成 `DreamAIChat_backend.zip` 文件
     - （可选）将 `DreamAIChat_backend.zip` 重命名为 `backend.zip`，方便后续操作
     
     **方法二：进入文件夹后压缩内容**
     - 打开文件资源管理器，导航到 `DreamAIChat_backend` 目录内部
     - 按 `Ctrl + A` 选中所有文件和文件夹
     - 右键点击选中的文件，选择 **"发送到"** → **"压缩(zipped)文件夹"**
     - 压缩完成后，zip 文件会生成在 `DreamAIChat_backend` 目录内
     - 将 zip 文件移动到上一级目录（`DreamAIChat_APP` 目录），方便后续上传
     
     **注意**：压缩完成后，zip 文件大小通常在 5-50 MB 之间（取决于是否包含 `build/` 目录）。如果文件很大（>100 MB），建议先删除 `build/` 目录再压缩。

  2. **使用 WinSCP 上传到服务器（图形界面，最简单）**
     
     - **下载 WinSCP**：
       - 访问 https://winscp.net/eng/download.php
       - 下载并安装 WinSCP（免费软件）
     
     - **连接服务器**：
       - 打开 WinSCP
       - 在登录界面填写：
         - **文件协议**：选择 `SFTP`
         - **主机名**：填写你的云服务器公网 IP，例如 `123.45.67.89`
         - **端口号**：`22`（默认 SSH 端口）
         - **用户名**：`root`（或你创建服务器时设置的用户名）
         - **密码**：填写你创建服务器时设置的密码（或 SSH 密钥）
       - 点击 **"登录"**
       - 首次连接会提示“主机密钥验证”，点击 **"是"** 保存密钥
     
     - **上传文件**：
       - 登录成功后，WinSCP 左侧显示你的本地文件，右侧显示服务器文件
       - 在左侧找到你刚才压缩的 `backend.zip` 文件（通常在 `DreamAIChat_backend` 目录的上一级）
       - 将 `backend.zip` 从左侧拖拽到右侧的 `/root/` 目录
       - 等待上传完成（会显示进度条）

  3. **在服务器上解压**
     
     回到你的 SSH 终端（PowerShell 或 PuTTY），执行：
     ```bash
     cd /root
     unzip backend.zip
     cd DreamAIChat_backend
     ```
     如果服务器没有 `unzip` 命令，先安装：
     ```bash
     apt install -y unzip  # Ubuntu/Debian
     # 或
     yum install -y unzip  # CentOS
     ```
     
     **验证上传成功**：
     解压后，执行 `ls -la` 查看目录内容，应该能看到：
     - `src/` 目录（源代码）
     - `build.gradle.kts` 文件
     - `gradlew` 文件
     - 其他项目文件
     
     如果看到这些文件，说明上传和解压成功！

  **完整操作示例（以你的实际路径为例）**：
  
  假设你的云服务器 IP 是 `123.45.67.89`，密码是 `your_password`：
  
  1. **压缩**：
     - 打开文件资源管理器
     - 进入 `D:\ProgramFiles\CodeProjects\Android\projects\DreamAIChat\DreamAIChat_APP`
     - 右键 `DreamAIChat_backend` → "发送到" → "压缩(zipped)文件夹"
     - 等待完成，得到 `DreamAIChat_backend.zip`
  
  2. **上传**：
     - 打开 WinSCP
     - 填写：主机名 `123.45.67.89`，用户名 `root`，密码 `your_password`，协议 `SFTP`
     - 点击"登录"
     - 左侧找到 `D:\ProgramFiles\CodeProjects\Android\projects\DreamAIChat\DreamAIChat_APP\DreamAIChat_backend.zip`
     - 拖拽到右侧 `/root/` 目录
     - 等待上传完成（进度条到 100%）
  
  3. **解压**：
     - 打开 PowerShell，SSH 连接到服务器：
       ```powershell
       ssh root@123.45.67.89
       ```
     - 输入密码后，执行：
       ```bash
       cd /root
       unzip DreamAIChat_backend.zip
       cd DreamAIChat_backend
       ls -la  # 查看文件列表，确认解压成功
       ```
  
  完成！现在我们后端代码已经在云服务器上了。

  **方式 2B：使用 PowerShell + scp（命令行方式）**

  1. **在本地压缩后端目录（使用 PowerShell）**
     
     打开 PowerShell（按 `Win + X`，选择 "Windows PowerShell" 或 "终端"）：
     
     ```powershell
     # 进入后端目录的父目录
     cd D:\ProgramFiles\CodeProjects\Android\projects\DreamAIChat\DreamAIChat_APP
     
     # 压缩 DreamAIChat_backend 目录（需要 PowerShell 5.0+）
     Compress-Archive -Path DreamAIChat_backend -DestinationPath backend.zip -Force
     ```
     
     如果提示 `Compress-Archive` 不存在，说明你的 PowerShell 版本较老，可以：
     - 使用方式 2A 的图形界面压缩
     - 或升级到 Windows 10/11（自带 PowerShell 5.0+）

  2. **启用 Windows 的 OpenSSH 客户端（如果还没启用）**
     
     - 打开 **"设置"** → **"应用"** → **"可选功能"**
     - 搜索 "OpenSSH 客户端"
     - 如果未安装，点击 **"安装"**
     - 或者使用管理员权限的 PowerShell 执行：
       ```powershell
       Add-WindowsCapability -Online -Name OpenSSH.Client~~~~0.0.1.0
       ```

  3. **使用 scp 上传到服务器**
     
     在 PowerShell 中执行（将 `123.45.67.89` 替换为你的云服务器 IP）：
     ```powershell
     scp backend.zip root@123.45.67.89:/root/
     ```
     
     首次连接会提示：
     ```
     The authenticity of host '123.45.67.89 (123.45.67.89)' can't be established.
     ECDSA key fingerprint is SHA256:xxxxx.
     Are you sure you want to continue connecting (yes/no)?
     ```
     输入 `yes` 并回车
     
     然后会提示输入密码：
     ```
     root@123.45.67.89's password:
     ```
     输入你的服务器密码（输入时不会显示，输入完直接回车）
     
     上传成功后，会显示：
     ```
     backend.zip    100%  xxxxxx  xxxxxx/s  xx:xx
     ```

  4. **在服务器上解压**（同方式 2A 的第 3 步）

  **方式 2C：使用 PowerShell 的 Compress-Archive + WinSCP（混合方式）**

  如果你喜欢用命令行压缩，但用图形界面上传：
  
  1. 在 PowerShell 中压缩（同方式 2B 的第 1 步）
  2. 使用 WinSCP 上传（同方式 2A 的第 2 步）
  3. 在服务器上解压（同方式 2A 的第 3 步）

  **常见问题：**

  - **Q: scp 提示 "command not found"**  
    A: 说明 OpenSSH 客户端未安装，按方式 2B 的第 2 步启用，或直接使用 WinSCP（方式 2A）

  - **Q: scp 提示 "Permission denied"**  
    A: 检查用户名和密码是否正确，或确认服务器是否允许密码登录（有些服务器只允许 SSH 密钥登录）

  - **Q: 上传的 zip 文件在服务器上找不到**  
    A: 确认上传路径，`/root/` 是 root 用户的家目录，如果使用其他用户，路径可能是 `/home/用户名/`

  - **Q: 压缩文件太大，上传很慢**  
    A: 可以先删除 `build/` 目录（编译产物）再压缩，或使用 Git 方式（方式一）只上传源代码

### 5.5 在云服务器上运行 Spring Boot 后端

#### 5.5.1 使用 Gradle Wrapper 直接运行（开发/测试）

1. 在云服务器上进入后端目录：
   ```bash
   cd /root/DreamAIChat_backend
   ```

2. **重要：给 gradlew 添加执行权限（必须！）**
   
   解压后的 `gradlew` 文件默认没有执行权限，需要先添加：
   ```bash
   chmod +x gradlew
   ```
   
   验证权限是否添加成功：
   ```bash
   ls -l gradlew
   ```
   应该看到类似：`-rwxr-xr-x 1 root root ... gradlew`（注意有 `x` 表示可执行）
   
   **如果遇到 "Permission denied" 错误，就是因为这一步没做！**

3. 配置环境变量（DeepSeek / 豆包 Key，按需）：
   ```bash
   export DEEPSEEK_API_KEY=sk-...
   export DOUBAO_API_KEY=69...
   ```
4. 运行后端（建议使用 `screen` 或 `nohup` 后台运行）：
   ```bash
   ./gradlew bootRun --args='--server.port=8082'
   ```
5. 确认启动成功：
   - 控制台应输出：`Tomcat started on port 8082`；  
   - 在本地浏览器访问：`http://123.45.67.89:8082/actuator/health`（如已开启 Actuator）或直接调用登录接口测试。

#### 5.5.2 打包为 Jar 再运行（稍更正式）

1. **确保 gradlew 有执行权限**（如果 15.5.1 中已执行过，可跳过）：
   ```bash
   cd /root/DreamAIChat_backend
   chmod +x gradlew
   ```

2. 在服务器上执行打包：
   ```bash
   ./gradlew bootJar
   ```
3. 找到生成的 Jar（通常在 `build/libs/` 目录下）。  
4. 在服务器运行 Jar：
   ```bash
   java -jar build/libs/DreamAIChat_backend-1.0.0.jar --server.port=8082
   ```

### 5.6 修改 Android 前端指向云端后端

1. 在本地打开 `RetrofitClient.java`：  
   ```java
   private static final String BASE_URL = "http://123.45.67.89:8082/";
   ```
   将 `123.45.67.89` 替换为你的云服务器公网 IP。  
2. 重新编译并生成 APK（`Build APK(s)`）。  
3. 将新的 APK 提供给老师或其他同学安装。  
4. 只要他们的手机能访问公网（不在极端受限网络下），APP 就会通过云服务器访问后端 → 再访问大模型，实现完整在线体验。

### 5.7 常见问题与排查

1. **执行 `./gradlew` 时提示 "Permission denied"**  
   - **原因**：`gradlew` 文件没有执行权限  
   - **解决**：执行 `chmod +x gradlew` 添加执行权限  
   - **预防**：解压后立即执行 `chmod +x gradlew`，然后再运行其他命令

2. **手机打不开后端地址 / 请求失败**  
   - 检查云服务器安全组是否放通了对应端口（8082 或 80）；  
   - 在本地浏览器访问 `http://123.45.67.89:8082` 看是否有响应；
   - 检查服务器防火墙（`ufw` 或 `firewalld`）是否允许该端口。

3. **模型仍然是"演示模式"**  
   - 在云服务器上执行诊断接口：  
     ```bash
     curl http://localhost:8082/api/diagnostics/providers
     ```
   - 根据返回的 `apiKeyConfigured` / `dnsResolved` / `reachable` 字段逐项修复；
   - 确认云服务器可以访问 DeepSeek / 豆包的域名和 443 端口（有些公司/学校网络会限制外联）。

4. **想用域名而不是 IP**  
   - 购买域名后，将域名解析到云服务器 IP；  
   - 在 `application.yml` 中设置 `server.port: 80` 或使用 Nginx 反向代理到 8082；  
   - 将 `BASE_URL` 改成 `http://your-domain.com/`。

> 对于我们训练营 Demo，最简单的做法是：云服务器上跑后端 + 用公网 IP + 端口，Android 端直接写这个 IP 即可，不一定要上 HTTPS / 域名，但正式上线则建议加上。

### 5.8 云服务器的关闭与重启

#### 5.8.1 正确关闭后端服务（在关闭服务器前）

在关闭云服务器之前，需要先正确停止正在运行的后端服务，避免数据丢失或进程异常。

**方法一：如果后端在终端前台运行**

1. 在运行后端的终端窗口中，按 `Ctrl + C` 停止服务
2. 等待几秒，直到看到类似 "Process finished" 的提示
3. 确认服务已停止后，再关闭服务器

**方法二：如果后端在后台运行（使用 screen 或 nohup）**

1. **查找后端进程（找到 PID）**
   
   在服务器终端执行以下命令：
   ```bash
   # 查找 Java 进程（Spring Boot 后端）
   ps aux | grep java
   ```
   
   **命令输出示例**：
   ```
   root      12345  2.5  5.2  xxxxxx  xxxxxx  ?  Sl  10:30  0:15 java -jar build/libs/DreamAIChat_backend-1.0.0.jar --server.port=8082
   root      12380  0.1  0.2  xxxxxx  xxxxxx  ?  S   10:35  0:00 grep --color=auto java
   ```
   
   **如何理解输出**：
   - 第一行是实际的 Java 进程（你的后端服务）
   - 第二行是 `grep` 命令本身（可以忽略）
   - **PID 就是第二列的数字**，例如上面示例中的 `12345`
   
   **如果使用 Gradle Wrapper 运行**，也可以查找 Gradle 进程：
   ```bash
   ps aux | grep gradle
   ```
   
   输出示例：
   ```
   root      12456  3.2  6.1  xxxxxx  xxxxxx  ?  Sl  10:30  0:20 /usr/bin/java -jar /root/.gradle/wrapper/dists/.../gradle-wrapper.jar bootRun --args='--server.port=8082'
   root      12480  0.1  0.2  xxxxxx  xxxxxx  ?  S   10:35  0:00 grep --color=auto gradle
   ```
   PID 是 `12456`（第二列）
   
   **如何确认哪个进程是你的后端**：
   - 看命令行参数，包含 `DreamAIChat_backend` 或 `--server.port=8082` 的就是后端进程
   - 或者看进程启动时间，最近启动的那个通常就是

2. **停止进程**
   
   **方法 A：使用 screen（推荐，最安全）**
   ```bash
   # 先查看有哪些 screen 会话
   screen -ls
   # 输出示例：
   # There is a screen on:
   #     12345.backend    (Attached)
   
   # 进入 screen 会话（替换 12345.backend 为实际的会话名）
   screen -r 12345.backend
   # 或者如果只有一个会话，直接：
   screen -r
   
   # 进入后，按 Ctrl + C 停止后端服务
   # 然后输入 exit 退出 screen
   ```
   
   **方法 B：直接杀死进程（如果 screen 方法不行）**
   
   找到 PID 后（例如是 `12345`），执行：
   ```bash
   # 先尝试正常停止（推荐）
   kill 12345
   
   # 等待几秒，然后检查进程是否还在
   ps aux | grep java
   
   # 如果进程还在（说明正常停止失败），使用强制杀死
   kill -9 12345
   ```
   
   **完整操作示例**：
   ```bash
   # 步骤 1：查找进程
   ps aux | grep java
   # 输出：root  12345  2.5  5.2  ...  java -jar build/libs/DreamAIChat_backend-1.0.0.jar
   #       ↑     ↑
   #      用户   PID（这就是我们要的！）
   
   # 步骤 2：停止进程（假设 PID 是 12345）
   kill 12345
   
   # 步骤 3：验证是否停止成功
   ps aux | grep java
   # 如果只看到 grep 那一行，说明进程已停止 ✅
   ```

3. **验证服务已停止**
   
   **方法一：通过端口查找进程（最简单）**
   ```bash
   # 检查端口 8082 是否还在被占用
   lsof -i :8082
   ```
   
   **输出示例（如果服务还在运行）**：
   ```
   COMMAND   PID USER   FD   TYPE DEVICE SIZE/OFF NODE NAME
   java    12345 root   45u  IPv6  xxxxxx      0t0  TCP *:8082 (LISTEN)
   ```
   - 如果看到输出，说明服务还在运行，PID 是 `12345`（第二列）
   - 如果没有输出（只显示命令提示符），说明服务已停止 ✅
   
   **方法二：使用 netstat（如果 lsof 不可用）**
   ```bash
   netstat -tlnp | grep 8082
   ```
   
   **输出示例（如果服务还在运行）**：
   ```
   tcp6       0      0 :::8082                 :::*                    LISTEN      12345/java
   ```
   - PID 在最后一列：`12345/java`
   - 如果没有输出，说明服务已停止 ✅
   
   **方法三：再次查找 Java 进程**
   ```bash
   ps aux | grep java
   ```
   - 如果只看到 `grep` 那一行，说明所有 Java 进程都已停止 ✅
   - 如果还看到包含 `DreamAIChat_backend` 或 `8082` 的进程，说明服务还在运行

**快速查找 PID 的完整流程（总结）**：

如果你只知道后端运行在 8082 端口，最快的方法是：
```bash
# 一步到位：通过端口直接找到 PID
lsof -i :8082
# 输出第二列就是 PID，例如：12345

# 然后直接停止
kill 12345

# 验证是否停止
lsof -i :8082
# 如果没有输出，说明已停止 ✅
```

#### 5.8.2 在火山引擎控制台关闭云服务器

1. **登录火山引擎控制台**
   - 访问火山引擎官网，登录你的账号
   - 进入 **"云服务器 ECS"** 管理页面

2. **找到你的服务器实例**
   - 在实例列表中，找到你正在使用的服务器
   - 确认实例名称或 IP 地址，避免误操作

3. **关闭服务器**
   - 点击实例右侧的 **"更多"** 或 **"操作"** 按钮
   - 选择 **"停止"** 或 **"关机"**
   - 在弹出的确认对话框中，选择关闭方式：
     - **正常关机**（推荐）：系统会先执行正常的关机流程，保存数据，然后关闭
     - **强制关机**：立即断电，可能导致数据丢失（不推荐，除非服务器无响应）
   - 点击 **"确定"** 确认关闭

4. **等待关闭完成**
   - 服务器状态会变为 **"已停止"** 或 **"已关机"**
   - 关闭过程通常需要 1-3 分钟
   - **注意**：关闭后，服务器不再产生计算资源费用，但可能仍会产生存储费用（取决于你的计费方式）

#### 5.8.3 重启云服务器

当你需要再次使用服务器时，可以重新启动：

1. **在火山引擎控制台重启**
   - 登录火山引擎控制台，进入 **"云服务器 ECS"** 页面
   - 找到已关闭的服务器实例
   - 点击实例右侧的 **"启动"** 或 **"开机"** 按钮
   - 等待 2-5 分钟，服务器状态变为 **"运行中"**

2. **验证服务器已启动**
   - 在控制台查看服务器状态为 **"运行中"**
   - 查看公网 IP 是否与之前一致（通常不会变化，除非你手动释放了 IP）

3. **重新连接服务器**
   ```bash
   ssh root@你的服务器IP
   ```
   输入密码后登录

4. **检查后端服务状态**
   ```bash
   # 检查后端是否还在运行
   ps aux | grep java
   # 或检查端口
   netstat -tlnp | grep 8082
   ```
   
   **如果后端没有运行**（这是正常的，因为服务器重启后所有进程都会停止），需要重新启动后端：

5. **重新启动后端服务**
   
   按照 15.5 节的步骤重新启动：
   ```bash
   cd /root/DreamAIChat_backend
   
   # 配置环境变量（如果之前没有持久化）
   export DEEPSEEK_API_KEY=sk-你的密钥
   export DOUBAO_API_KEY=你的豆包密钥
   
   # 如果使用 Gradle Wrapper 运行
   ./gradlew bootRun --args='--server.port=8082'
   
   # 或者如果已经打包过 Jar
   java -jar build/libs/DreamAIChat_backend-1.0.0.jar --server.port=8082
   ```

6. **使用 screen 或 nohup 后台运行（推荐）**
   
   为了避免 SSH 断开后服务停止，建议使用后台运行：
   ```bash
   # 方法一：使用 screen（推荐）
   screen -S backend
   cd /root/DreamAIChat_backend
   export DEEPSEEK_API_KEY=sk-你的密钥
   export DOUBAO_API_KEY=你的豆包密钥
   ./gradlew bootRun --args='--server.port=8082'
   # 按 Ctrl + A，然后按 D 退出 screen（服务继续运行）
   
   # 重新连接 screen：screen -r backend
   
   # 方法二：使用 nohup
   cd /root/DreamAIChat_backend
   export DEEPSEEK_API_KEY=sk-你的密钥
   export DOUBAO_API_KEY=你的豆包密钥
   nohup ./gradlew bootRun --args='--server.port=8082' > backend.log 2>&1 &
   # 查看日志：tail -f backend.log
   ```

#### 5.8.4 让后端服务开机自启动（高级，可选）

如果你希望服务器重启后自动启动后端服务，可以配置 systemd 服务（以 Ubuntu 为例）：

1. **创建 systemd 服务文件**：
   ```bash
   sudo nano /etc/systemd/system/dreamaichat-backend.service
   ```

2. **写入以下内容**（根据你的实际路径和配置修改）：
   ```ini
   [Unit]
   Description=DreamAIChat Backend Service
   After=network.target
   
   [Service]
   Type=simple
   User=root
   WorkingDirectory=/root/DreamAIChat_backend
   Environment="DEEPSEEK_API_KEY=sk-你的密钥"
   Environment="DOUBAO_API_KEY=你的豆包密钥"
   ExecStart=/usr/bin/java -jar /root/DreamAIChat_backend/build/libs/DreamAIChat_backend-1.0.0.jar --server.port=8082
   Restart=always
   RestartSec=10
   
   [Install]
   WantedBy=multi-user.target
   ```

3. **启用并启动服务**：
   ```bash
   sudo systemctl daemon-reload
   sudo systemctl enable dreamaichat-backend
   sudo systemctl start dreamaichat-backend
   ```

4. **检查服务状态**：
   ```bash
   sudo systemctl status dreamaichat-backend
   ```

> **注意**：配置开机自启动需要一定的 Linux 系统管理经验，如果不太熟悉，可以每次手动启动，或者使用 screen/nohup 方式。

#### 5.8.5 常见问题

- **Q: 关闭服务器后，数据会丢失吗？**  
  A: 不会。服务器关闭只是停止运行，数据仍然保存在磁盘上。重启后会恢复。

- **Q: 服务器重启后，公网 IP 会变化吗？**  
  A: 通常不会变化，除非你手动释放了 IP 或选择了按量计费的弹性 IP。建议在控制台确认 IP 是否变化。

- **Q: 重启后后端服务自动停止是正常的吗？**  
  A: 是的，这是正常的。服务器重启后所有进程都会停止，需要手动重新启动后端服务。

- **Q: 如何让后端服务在服务器重启后自动启动？**  
  A: 参考 15.8.4 节配置 systemd 服务，或使用其他进程管理工具（如 supervisor、pm2 等）。



## 6 数据库配置

### 6.1 什么是 Room 数据库？

**简单理解**：
- Room 是 Android 官方提供的数据库框架，基于 SQLite
- 就像 Excel 表格一样，用来存储应用的数据（用户信息、聊天记录等）
- 数据会保存在手机本地，即使关闭应用也不会丢失

**数据库结构**：
- **users 表**：存储用户信息（账号、密码、用户名等）
- **conversations 表**：存储会话信息（对话标题、使用的模型等）
- **messages 表**：存储消息内容（用户消息、AI回复等）

**数据关系**：
```
用户 (users)
  └── 会话 (conversations) - 一个用户可以有多个会话
        └── 消息 (messages) - 一个会话可以有多条消息
```

#### 6.1.1 Room 与 JDBC / Navicat 的直观对比

| 维度 | JDBC + Navicat | Room |
| --- | --- | --- |
| 思维模型 | 手写 SQL → 用连接串连到 MySQL | 仍然是 SQLite，但用注解描述表结构，Room 自动生成 SQL |
| 连接方式 | 直接连接远程数据库，Navicat 可实时查看 | App 内嵌 SQLite 文件，运行在手机沙箱；通过工具“窥视” |
| 常见开发痛点 | 需要手动管理连接、事务、游标 | Room 自动处理线程/事务，可用 DAO 接口声明 CRUD |
| 适用场景 | 服务端、PC 工具 | Android 客户端离线缓存、本地持久化 |

可以把 Room 想象成“内嵌版的 Navicat + ORM”：

1. **Entity（表结构）** ≈ Navicat 中建表
2. **DAO（接口）** ≈ 在 Navicat 里运行的 SQL 语句
3. **Database（AppDatabase）** ≈ Navicat 的连接配置

#### 6.1.2 Room 的“三件套”在项目中的对应文件

| 角色 | 职责 | 对应文件 |
| --- | --- | --- |
| `@Entity` | 描述表字段 | `data/entity/ConversationEntity.java`、`MessageEntity.java`、`UserEntity.java` |
| `@Dao` | 定义 CRUD 接口 | `data/dao/ConversationDao.java`、`MessageDao.java`、`UserDao.java` |
| `RoomDatabase` | 提供数据库访问入口 | `data/database/AppDatabase.java` |

调用顺序：

```
ChatViewModel → MessageRepository → MessageDao → Room → SQLite
```

所以你在 UI 层只需调用 Repository，Room 会负责把请求翻译成 SQL 并更新 SQLite 文件。

#### 6.1.3 和本项目的业务映射

- 登录后，`SessionManager` 保存 `userId`
- 聊天时：
  1. `ChatViewModel` 组装 `ConversationEntity` / `MessageEntity`
  2. 通过 `ConversationRepository`、`MessageRepository` 写入 Room
  3. 历史页面 (`HistoryFragment`) 通过 DAO 查询 `conversations`，RecyclerView 展示

理解这条链路后，再去看 `ConversationRepository.insertOrUpdateConversation()` 与 `ChatViewModel.persistConversationAndMessages()` 会更加直观。

### 6.2 数据库文件位置

**数据库文件位置**：
- 应用首次运行后，数据库文件会自动创建
- 位置：`/data/data/com.example.dreamaichat_app/databases/dreamai_chat.db`
- 这是应用私有目录，其他应用无法访问

**如何查看数据库文件**（开发调试）：
1. 使用 Android Studio 的 Device File Explorer
   - 点击 `View` → `Tool Windows` → `Device File Explorer`
   - 导航到 `/data/data/com.example.dreamaichat_app/databases/`
   - 可以看到 `dreamai_chat.db` 文件

2. 使用 ADB 命令（需要 root 权限）
   ```bash
   adb shell
   run-as com.example.dreamaichat_app
   cd databases
   ls
   ```

### 6.3 数据库配置说明

**步骤 1：检查数据库文件是否已创建**

数据库文件在以下位置：
```
app/src/main/java/com/example/dreamaichat_app/data/database/AppDatabase.java
```

**步骤 2：了解数据库配置**

打开 `AppDatabase.java`，你会看到以下配置：

```java
@Database(
    entities = {
        UserEntity.class,        // 用户表
        ConversationEntity.class, // 会话表
        MessageEntity.class      // 消息表
    },
    version = 1,  // 数据库版本号
    exportSchema = false
)
```

**重要配置说明**：

1. **数据库名称**：
   
   ```java
   private static final String DATABASE_NAME = "dreamai_chat.db";
   ```
   - 这是数据库文件名
   - 可以修改为你想要的名称（如 `my_chat.db`）
   - 修改后，旧数据库会被删除（开发环境）
   
2. **数据库版本**：
   ```java
   version = 1
   ```
   - 每次修改表结构（添加字段、删除表等）时，需要递增版本号
   - 例如：第一次修改后改为 `version = 2`
   - 生产环境需要实现 `Migration` 类来迁移数据

3. **开发环境配置**：
   ```java
   .fallbackToDestructiveMigration()  // 版本升级时删除旧数据
   .allowMainThreadQueries()          // 允许在主线程查询
   ```
   - **注意**：这些配置仅用于开发环境
   - 生产环境需要移除 `allowMainThreadQueries()`，并使用后台线程

### 6.4 数据库初始化流程

**首次运行应用时**：

1. **应用启动** → 调用 `AppDatabase.getInstance(context)`
2. **Room 框架检查** → 数据库文件是否存在？
   - 如果不存在 → 创建数据库文件
   - 如果存在 → 检查版本号是否匹配
3. **创建表结构** → 根据 `@Entity` 注解自动创建表
4. **数据库就绪** → 可以开始使用

**数据库表结构**：

**users 表**：
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | Long | 用户ID（主键，自动生成）|
| account | String | 用户账号（手机号或邮箱）|
| password | String | 密码（加密后）|
| username | String | 用户名 |
| avatarUrl | String | 头像URL |
| memberType | String | 会员类型（free/premium）|
| token | String | 登录Token |
| tokenExpireTime | Long | Token过期时间 |
| createdAt | Long | 创建时间 |
| updatedAt | Long | 更新时间 |

**conversations 表**：
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | Long | 会话ID（主键，自动生成）|
| userId | Long | 用户ID（外键）|
| title | String | 会话标题 |
| model | String | 使用的AI模型 |
| messageCount | Integer | 消息总数 |
| isFavorite | Boolean | 是否收藏 |
| lastMessagePreview | String | 最后消息预览 |
| lastMessageTime | Long | 最后消息时间 |
| createdAt | Long | 创建时间 |
| updatedAt | Long | 更新时间 |

**messages 表**：
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | Long | 消息ID（主键，自动生成）|
| conversationId | Long | 会话ID（外键）|
| role | String | 消息类型（user/assistant/system）|
| content | String | 消息内容 |
| status | String | 消息状态（sending/success/failed）|
| errorMessage | String | 错误信息 |
| createdAt | Long | 创建时间 |
| updatedAt | Long | 更新时间 |

### 6.5 如何使用数据库

**在代码中使用数据库**：

1. **获取 Repository 实例**：
   ```java
   UserRepository userRepository = new UserRepository(context);
   ```

2. **插入数据**：
   ```java
   UserEntity user = new UserEntity("user@example.com", "password", "用户名");
   userRepository.insertOrUpdateUser(user)
       .subscribe(
           () -> Log.d("Database", "用户保存成功"),
           error -> Log.e("Database", "保存失败", error)
       );
   ```

3. **查询数据**：
   ```java
   userRepository.getUserByAccount("user@example.com")
       .subscribe(
           user -> Log.d("Database", "找到用户: " + user.username),
           error -> Log.e("Database", "查询失败", error)
       );
   ```

### 6.6 数据库迁移（生产环境）

**什么时候需要迁移**：

- 修改了表结构（添加字段、删除字段、修改字段类型）
- 需要保留旧数据

**迁移步骤**：

1. **增加数据库版本号**：
   ```java
   @Database(..., version = 2)  // 从 1 改为 2
   ```

2. **创建 Migration 类**：
   ```java
   static final Migration MIGRATION_1_2 = new Migration(1, 2) {
       @Override
       public void migrate(SupportSQLiteDatabase database) {
           // 添加新字段
           database.execSQL("ALTER TABLE users ADD COLUMN nickname TEXT");
       }
   };
   ```

3. **应用 Migration**：
   ```java
   .addMigrations(MIGRATION_1_2)
   ```

### 6.7 验证数据库是否正常工作

**方法 1：查看日志**

运行应用后，在 Logcat 中搜索 "Database" 或 "Room"：
- 如果看到 "数据库创建成功" 或类似日志，说明数据库正常
- 如果看到错误信息，检查配置是否正确

**方法 2：测试数据操作**

在代码中添加测试代码：
```java
// 测试插入用户
UserRepository repository = new UserRepository(context);
UserEntity testUser = new UserEntity("test@example.com", "123456", "测试用户");
repository.insertOrUpdateUser(testUser)
    .subscribe(
        () -> Log.d("Test", "✅ 数据库测试成功"),
        error -> Log.e("Test", "❌ 数据库测试失败", error)
    );
```

**方法 3：使用数据库查看工具**

1. 导出数据库文件到电脑
2. 使用 SQLite 查看工具（如 DB Browser for SQLite）打开
3. 查看表结构和数据

### 6.8 常见问题

**问题 1：数据库文件未创建**

**原因**：
- 应用未运行
- 数据库初始化失败

**解决方法**：
1. 确保应用已运行至少一次
2. 检查 `AppDatabase.java` 中的配置是否正确
3. 查看 Logcat 中的错误信息

**问题 2：Room 编译错误**

**原因**：
- 缺少 `kapt` 插件
- `room-compiler` 依赖未正确配置

**解决方法**：
1. 检查 `app/build.gradle.kts` 中是否包含：
   ```kotlin
   plugins {
       alias(libs.plugins.kotlin.kapt)
   }
   dependencies {
       kapt(libs.room.compiler)
   }
   ```
2. 同步 Gradle：`File` → `Sync Project with Gradle Files`
3. 清理项目：`Build` → `Clean Project`

**问题 3：数据丢失**

**原因**：
- 使用了 `fallbackToDestructiveMigration()`
- 数据库版本号改变

**解决方法**：
- 开发环境：这是正常行为，数据会被清空
- 生产环境：实现 `Migration` 类来保留数据

**问题 4：查询返回空数据**

**原因**：
- 数据未插入
- 查询条件错误

**解决方法**：
1. 检查数据是否已插入（使用数据库查看工具）
2. 检查查询条件是否正确
3. 查看 Logcat 中的查询日志

### 6.9 数据可视化 & 调试工具（Navicat 思路平移）

即便数据库在手机沙箱里，仍然可以像 Navicat 一样“看表、跑 SQL”：

1. **Android Studio Database Inspector（实时查看）**
   - 运行 App → `View` → `Tool Windows` → `App Inspection`
   - 选择正在运行的进程 → 展开 `Databases` → `dreamai_chat.db`
   - 可以直接浏览表、双击行、甚至执行 `SELECT * FROM messages ORDER BY createdAt DESC`
   - 支持热更新：当你在 App 内发送一条消息，Inspector 会立刻刷新

2. **导出 SQLite 文件后用桌面工具查看**
   - `adb shell run-as com.example.dreamaichat_app cp /data/data/com.example.dreamaichat_app/databases/dreamai_chat.db /sdcard/Download/dreamai_chat.db`
   - `adb pull /sdcard/Download/dreamai_chat.db .`
   - 使用 DB Browser for SQLite / SQLiteStudio / TablePlus 打开，就像用 Navicat 查看 MySQL

3. **第三方插件**
   - Android Studio Marketplace 中搜索 “SampleSQLiteBrowser”，可以获得更接近 Navicat 的界面

> 小贴士：Room 也可以开启 `setJournalMode(TRUNCATE)`、`setQueryCallback` 来把 SQL 打印到 Logcat，方便对照 JDBC 时代的 SQL。

### 6.9 数据库最佳实践

1. **使用后台线程**：
   - 生产环境必须在后台线程执行数据库操作
   - 使用 RxJava 的 `subscribeOn(Schedulers.io())`

2. **及时关闭连接**：
   - 应用退出时调用 `AppDatabase.closeDatabase()`
   - 避免内存泄漏

3. **数据备份**：
   - 定期备份重要数据
   - 使用 Room 的导出功能

4. **性能优化**：
   - 使用索引加速查询（已在 Entity 中定义）
   - 避免在主线程执行耗时操作
   - 使用批量插入提高效率



### 6.10 下一步

配置完数据库后：
1. ✅ 运行应用，确认数据库文件已创建
2. ✅ 测试数据插入和查询功能
3. ✅ 查看 Logcat 确认没有错误
4. ✅ 继续开发其他功能



## 7. 构建项目

### 7.1 使用 Android Studio

1. **选择构建变体**
   - 点击 `Build` → `Select Build Variant`
   - 选择 `debug` 或 `release`

2. **构建 APK**
   - 点击 `Build` → `Build Bundle(s) / APK(s)` → `Build APK(s)`
   - 构建完成后，APK 位于 `app/build/outputs/apk/`

3. **运行应用**
   - 连接 Android 设备或启动模拟器
   - 点击 `Run` → `Run 'app'` 或按 `Shift + F10`

### 7.2 使用命令行

#### Windows

```powershell
# 清理构建
.\gradlew clean

# 构建 Debug APK
.\gradlew assembleDebug

# 构建 Release APK
.\gradlew assembleRelease

# 安装到设备
.\gradlew installDebug
```

#### macOS/Linux

```bash
# 清理构建
./gradlew clean

# 构建 Debug APK
./gradlew assembleDebug

# 构建 Release APK
./gradlew assembleRelease

# 安装到设备
./gradlew installDebug
```



## 8. 运行应用

### 8.1 在模拟器上运行

1. **创建模拟器**
   - 打开 `Tools` → `Device Manager`
   - 点击 `Create Device`
   - 选择设备型号和系统镜像（API 21+）
   - 完成创建

2. **运行应用**
   - 选择创建的模拟器
   - 点击 `Run` 按钮

### 8.2 在真机上运行

1. **启用开发者选项**
   - 打开设备 `设置` → `关于手机`
   - 连续点击 `版本号` 7次
   - 返回设置，找到 `开发者选项`

2. **启用 USB 调试**
   - 在 `开发者选项` 中启用 `USB 调试`
   - 连接设备到电脑

3. **运行应用**
   - Android Studio 会自动检测设备
   - 选择设备并点击 `Run`



## 9. 图片资源配置

> 本章我按“小白模式”来写：只假设你手里有一堆 PNG 图片，没有 SVG、不会写 XML，也不了解各种 density 的概念。只要跟着步骤做，就能把 APP 里的图标全部换成你自己的。

### 9.1 启动 / 桌面图标（只用 PNG 的完整步骤）

#### 9.1.1 准备一张“大图标”PNG

1. 准备一张 **方形** 的 PNG 图片，例如 1024×1024，背景最好是透明。
2. 把它放到电脑某个你能找到的位置，比如：`D:\my_icons\app_logo.png`。

#### 9.1.2 用 Image Asset 一次性生成所有 mipmap 和 XML

1. 打开 Android Studio，在左侧 `Project` 视图中找到 `app/src/main/res`。
2. 在 `res` 上 **右键** → `New` → `Image Asset`。  
3. 在弹出的窗口中：
   - `Icon Type` 选择：**Launcher Icons (Adaptive and Legacy)**。
   - `Name` 建议保持为：`ic_launcher`（默认），不要改名，这样不用动其他配置。
4. 在 `Foreground Layer` 里：
   - `Asset type` 选 **Image**。
   - 点击右边的文件夹按钮，选择你刚才准备的 PNG（例如 `app_logo.png`）。
   - 预览区会显示一个圆形/方形图标，如果图太大/太小，可以用下面的滑块调整缩放。
5. 如果不想要复杂背景：
   - 在 `Background Layer` 中，把 `Color` 改成你想要的纯色背景（比如白色或品牌色）。
6. 一路点击 `Next` → `Finish`。

完成后，Android Studio 会自动帮你生成和覆盖：

- `mipmap-mdpi/ic_launcher.png`
- `mipmap-hdpi/ic_launcher.png`
- `mipmap-xhdpi/ic_launcher.png`
- `mipmap-xxhdpi/ic_launcher.png`
- `mipmap-xxxhdpi/ic_launcher.png`
- `mipmap-anydpi-v26/ic_launcher.xml`
- 以及 `ic_launcher_round` 系列和对应的 XML。

> **重要**：这样做之后，我们**不需要自己改 XML**；那些 XML（包括你看到的 `ic_launcher.xml`）已经自动指向了你这张 PNG，Android 会自动处理各种分辨率和形状。

#### 9.1.3 只想手动覆盖 PNG，不想用 Image Asset？

不推荐，但如果你已经手动把 `mipmap-*` 里的 PNG 都换了，只剩 XML 不会改，可以这样理解：

- `mipmap-anydpi-v26/ic_launcher.xml` 是一个“配置文件”，里面只是告诉系统“前景图用哪个图片、背景用哪个图片”。
- 最简单的方式仍然是用 **9.1.2 的 Image Asset** 再跑一遍，这样会自动重写 XML，避免手工修改出错。

如果你坚持手动，不想重新跑 Image Asset，可以记住一句话：  
**“不要随便删或改 ic_launcher.xml 的结构，宁可用 Image Asset 重建。”**  
这样最安全、也最省心。

### 9.2 聊天界面 & 导航图标对照表（都可以换成 PNG）

| 资源 | 目录 | 使用场景 | 引用文件 | 替换建议 |
| --- | --- | --- | --- | --- |
| `ic_attach` | `drawable/` | 输入框"图片"按钮（无背景图标按钮） | `fragment_chat.xml` | 32dp 附件图标，建议使用单色或透明背景 PNG |
| `ic_send` | `drawable/` | 输入框"发送"按钮（无背景图标按钮） | `fragment_chat.xml` | 32dp 发送图标，建议使用箭头或发送符号 PNG |
| `ic_user_avatar` | `drawable/` | "我的"页面用户头像 | `fragment_profile.xml` | 80×80dp 用户头像，建议使用圆形头像 PNG |
| `ic_template_code` | `drawable/` | 对话模板"编程助手"图标 | `item_template_simple.xml` | 40×40dp 编程相关图标 PNG |
| `ic_template_paper` | `drawable/` | 对话模板"论文助手"图标 | `item_template_simple.xml` | 40×40dp 文档/论文相关图标 PNG |
| `ic_template_medical` | `drawable/` | 对话模板"医疗咨询"图标 | `item_template_simple.xml` | 40×40dp 医疗/健康相关图标 PNG |
| `ic_template_translate` | `drawable/` | 对话模板"翻译专家"图标 | `item_template_simple.xml` | 40×40dp 翻译/语言相关图标 PNG |
| `ic_copy_16` | `drawable/` | AI 气泡复制按钮 | `item_message_ai.xml` | 16–20dp，避免遮挡文本 |
| `ic_chevron_down` | `drawable/` | 模型切换箭头 | `fragment_chat.xml`（模型 header） | 仅改色可在 XML 里调 `fillColor` |
| `ic_ai_avatar_placeholder` | `drawable/` | AI 头像占位 | `item_message_ai.xml` | 可替换为品牌角色头像 |
| `ic_pin_indicator` | `drawable/` | 历史置顶提示 | `item_conversation.xml` | 16dp 以内的小钉子图标 |
| `ic_close_24` | `drawable/` | 附件缩略图删除 | `item_attachment_preview.xml` | 建议用简单叉号/垃圾桶图 |
| `ic_menu_24` | `drawable/` | Toolbar 左上角抽屉图标 | `activity_main.xml` | 可改为品牌 LOGO |
| `bg_model_tag` | `drawable/` (Shape) | 模型标签背景 | `fragment_chat.xml`、`item_conversation.xml` | 改颜色/圆角即可 |
| `bg_system_message` | `drawable/` (Shape) | “正在生成”提示 & 附件卡片 | `fragment_chat.xml` | 改成你喜欢的气泡样式 |
| `divider_attachment_preview` | `drawable/` (Shape) | 附件分隔线 | `fragment_chat.xml` | 想去掉分隔线就设为透明 |
| `ic_tab_chat` | `drawable/` | 底部 TabBar“聊天”图标 | `bottom_navigation.xml` | 建议用聊天气泡相关 PNG |
| `ic_tab_history` | `drawable/` | 底部 TabBar“历史”图标 | `bottom_navigation.xml` | 用时钟/列表类图标 |
| `ic_tab_profile` | `drawable/` | 底部 TabBar“我的”图标 | `bottom_navigation.xml` | 用头像/用户轮廓图标 |
| `ic_toolbar_new_chat` | `drawable/` | 顶部“新对话”按钮 | `toolbar_menu.xml` | 可用“+”或“新建”相关图标 |
| `ic_toolbar_settings` | `drawable/` | 顶部“设置”按钮 | `toolbar_menu.xml` | 用齿轮类 PNG |
| `ic_nav_templates` | `drawable/` | 侧边栏“对话模板” | `nav_drawer.xml` | 用文档/列表类图标 |
| `ic_nav_routing` | `drawable/` | 侧边栏“智能路由” | `nav_drawer.xml` | 用分支/箭头类图标 |
| `ic_nav_graph` | `drawable/` | 侧边栏“对话图谱” | `nav_drawer.xml` | 用网络/图谱类图标 |
| `ic_nav_settings` | `drawable/` | 侧边栏“设置” | `nav_drawer.xml` | 同样用齿轮图标 |
| `ic_nav_logout` | `drawable/` | 侧边栏“退出登录” | `nav_drawer.xml` | 用门/退出箭头等红色图标 |

按表替换同名文件即可，布局引用无需改动。

### 9.3 用 PNG 一步步替换所有界面图标（实战教程）

这里以几类典型图标为例：**聊天区域按钮**、**底部 TabBar 图标**、**顶部工具栏按钮**、**侧边栏菜单图标**。所有图标的本质操作是一样的：用 Image Asset 把对应的 `ic_xxx` 名称替换成你的 PNG。

#### 9.3.1 替换聊天输入框的"图片"按钮图标（ic_attach）

1. 在电脑上准备一张小图标 PNG，比如 96×96 或 128×128，放在 `D:\my_icons\attach.png`。
2. 在 Android Studio 左侧 `Project` 面板中：
   - 展开 `app/src/main/res/drawable/`
   - 找到 `ic_attach.xml`。
3. 右键 `drawable` 目录 → `New` → `Image Asset`（有些版本是 `New` → `Vector Asset`，不影响）。
4. 在弹窗中：
   - `Icon Type` 选择 **Action Bar and Tab Icons** 或 **Launcher Icons (Legacy Only)**（都可以，本质是生成一个小图标）。
   - `Name` 填写：**ic_attach**（一定要和原来的文件名一样，这样布局不用改）。
   - 源图选择你的 `attach.png`。
   - 大小一般选 24dp 或 32dp，预览里看着合适即可。
5. 点击 `Next` → `Finish`。  
   Android Studio 会自动在 `drawable/` 下生成或覆盖 `ic_attach.png` / `ic_attach.xml` 等资源，布局里引用的 `@drawable/ic_attach` 自动变成你的图标。

#### 9.3.1.1 替换聊天输入框的"发送"和"图片"按钮图标（ic_send / ic_attach）

**重要**：发送和图片按钮现在是**无背景的图标按钮**（ImageButton），与工具栏的"设置"和"新对话"按钮样式一致。

**按钮样式说明**：
- 使用 `ImageButton` 控件，无背景色
- 点击时有波纹效果（`selectableItemBackgroundBorderless`）
- 图标尺寸：32dp（按钮尺寸 56×56dp，padding 12dp）
- 图片按钮图标颜色：主题色（`@color/text_primary`）
- 发送按钮图标颜色：主色调（`@color/primary`）

**替换步骤**：

1. **替换"图片"按钮图标（ic_attach）**：
   - 准备一张附件/图片图标 PNG，建议 128×128，放在 `D:\my_icons\attach.png`
   - 右键 `drawable` 目录 → `New` → `Image Asset`
   - `Icon Type` 选择 **Action Bar and Tab Icons**
   - `Name` 填写：**ic_attach**
   - 源图选择你的 `attach.png`
   - 大小选 32dp（图标会显示在 56×56dp 的按钮中）
   - 点击 `Next` → `Finish`

2. **替换"发送"按钮图标（ic_send）**：
   - 准备一张发送图标 PNG，建议 128×128，放在 `D:\my_icons\send.png`
   - 右键 `drawable` 目录 → `New` → `Image Asset`
   - `Icon Type` 选择 **Action Bar and Tab Icons**
   - `Name` 填写：**ic_send**
   - 源图选择你的 `send.png`
   - 大小选 32dp
   - 点击 `Next` → `Finish`

**注意**：
- 图标会以主题色或主色调显示（通过 `app:tint` 属性控制），建议使用单色图标或透明背景的图标
- 如果希望图标保持原始颜色，可以在布局文件中移除 `app:tint` 属性

#### 9.3.1.2 替换"我的"页面用户头像（ic_user_avatar）

1. 准备一张用户头像 PNG，建议 256×256 或更大（方形），放在 `D:\my_icons\user_avatar.png`。
2. 右键 `drawable` 目录 → `New` → `Image Asset`。
3. 在弹窗中：
   - `Icon Type` 选择 **Action Bar and Tab Icons** 或 **Launcher Icons (Legacy Only)**。
   - `Name` 填写：**ic_user_avatar**。
   - 源图选择你的 `user_avatar.png`。
   - 大小选 80dp（与布局中的 ImageView 尺寸一致）。
4. 点击 `Next` → `Finish`。

**提示**：头像会以 `centerCrop` 模式显示，建议使用圆形或方形头像，确保主体在中心位置。

#### 9.3.1.3 替换对话模板图标（ic_template_code / ic_template_paper / ic_template_medical / ic_template_translate）

对话模板界面有 4 个模板，每个模板都有独立的图标：

- `ic_template_code` → "编程助手"模板图标
- `ic_template_paper` → "论文助手"模板图标  
- `ic_template_medical` → "医疗咨询"模板图标
- `ic_template_translate` → "翻译专家"模板图标

**替换步骤**（每个图标重复一次）：

1. 准备 4 张对应的 PNG 图标，建议 128×128，分别命名为：
   - `template_code.png`（编程相关图标，如代码符号、键盘等）
   - `template_paper.png`（文档相关图标，如纸张、文档等）
   - `template_medical.png`（医疗相关图标，如医疗十字、听诊器等）
   - `template_translate.png`（翻译相关图标，如语言符号、地球等）
2. 对每个图标，右键 `drawable` → `New` → `Image Asset`：
   - `Name` 分别填写：`ic_template_code`、`ic_template_paper`、`ic_template_medical`、`ic_template_translate`
   - 源图选择对应的 PNG
   - 大小选 40dp（与布局中的 ImageView 尺寸一致）
3. 每个都点击 `Next` → `Finish`。

完成后，对话模板界面中的 4 个模板卡片会显示你自定义的图标。

#### 9.3.2 替换 AI 头像占位图标（ic_ai_avatar_placeholder）

步骤和上面几乎一模一样：

1. 准备 PNG，比如 128×128，放到一个易找的目录。
2. 右键 `drawable` → `New` → `Image Asset`。
3. `Name` 填：**ic_ai_avatar_placeholder**。
4. 选择你的 PNG，调整大小，`Finish`。

> 你可以对照 9.2 表格，把其中所有的 `ic_xxx` 图标都按这一套方法换一遍，只要**名字不改**，布局和代码就都不用动。

#### 9.3.3 替换底部 TabBar 图标（聊天 / 历史 / 我的）

对应的资源名分别是：

- `ic_tab_chat`    → 底部“聊天”图标
- `ic_tab_history` → 底部“历史”图标
- `ic_tab_profile` → 底部“我的”图标

操作步骤和前面完全一样，只是 **Name 改成对应名字**：

1. 准备 3 张 PNG（建议 96×96 或 128×128），比如 `tab_chat.png` / `tab_history.png` / `tab_profile.png`。
2. 右键 `drawable` → `New` → `Image Asset`。
3. `Icon Type` 选择 Action Bar / 小图标类型即可。
4. 第一次：
   - `Name` 填：`ic_tab_chat`
   - 选择 `tab_chat.png`。
5. 第二次：
   - `Name` 填：`ic_tab_history`
   - 选择 `tab_history.png`。
6. 第三次：
   - `Name` 填：`ic_tab_profile`
   - 选择 `tab_profile.png`。

由于 `bottom_navigation.xml` 里已经改成引用 `@drawable/ic_tab_chat` 等，这样三步做完，底部三个 Tab 的图标就全部换成你的 PNG 了。

#### 9.3.4 替换顶部工具栏“新对话 / 设置”图标

对应的资源名：

- `ic_toolbar_new_chat`  → 顶部“新对话”按钮
- `ic_toolbar_settings`  → 顶部“设置”按钮

步骤同上：

1. 准备 2 张 PNG（比如“加号”图和“齿轮”图）。
2. 用 Image Asset 生成：
   - Name = `ic_toolbar_new_chat`  → 选新对话图标 PNG。
   - Name = `ic_toolbar_settings`  → 选设置图标 PNG。

`toolbar_menu.xml` 里已经用的是这两个名字，替换后重建即可生效。

#### 9.3.5 替换“我的”侧边栏菜单图标（模板 / 路由 / 图谱 / 设置 / 退出）

对应的资源名：

- `ic_nav_templates` → “对话模板”
- `ic_nav_routing`   → “智能路由”
- `ic_nav_graph`     → “对话图谱”
- `ic_nav_settings`  → “设置”
- `ic_nav_logout`    → “退出登录”

同样一人一遍 Image Asset：

1. 准备 5 张 PNG（文档、分支箭头、网络图、齿轮、退出箭头/门等）。
2. 右键 `drawable` → `New` → `Image Asset`。
3. 按上面 5 个名字分别导入：
   - Name = `ic_nav_templates`  → 选模板 PNG。
   - Name = `ic_nav_routing`   → 选路由 PNG。
   - Name = `ic_nav_graph`     → 选图谱 PNG。
   - Name = `ic_nav_settings`  → 选设置 PNG。
   - Name = `ic_nav_logout`    → 选退出 PNG。

`nav_drawer.xml` 中已经改为这些资源名，导入完成后，打开侧边栏就能看到替换后的效果。

### 9.4 其他图片资源及尺寸（简单记）

- 如果你有整屏插画（比如空白页的大图），只要放到 `drawable/` 目录，命名成好记的名字，比如 `empty_state.png`，然后在对应布局（如 `fragment_history.xml`）里把 `android:text="😔"` 改成一个 `ImageView` 引用你的 `@drawable/empty_state` 即可。
- 常用尺寸建议：

| 用途 | 推荐尺寸 | 目录 |
| --- | --- | --- |
| 启动页/空态插画 | 1080×1920 PNG/WebP | `drawable/` |
| 用户/AI 头像 | 64×64 PNG | `drawable/` |
| 小按钮图标 | 96×96 PNG | 通过 Image Asset 生成 24dp 图标 |
| 聊天气泡背景 | 建议用 Shape XML（不用 PNG） | `drawable/` |

### 9.5 更换图标 Checklist（照着勾即可）

1. **桌面图标**：按 9.1.2 用 Image Asset 跑一遍 `ic_launcher`。
2. **聊天页图标**：按 9.3.1、9.3.2 的方法，把 9.2 表格中所有 `ic_xxx` 都替换一遍。
3. **其他插画**：把 PNG 放到 `drawable/`，修改对应布局里的 `@drawable/...` 引用。
4. `Build` → `Rebuild Project`。
5. 真机/模拟器自测：桌面、聊天页、历史页、抽屉菜单是否都显示为你的素材。
6. 把 `res/` 里的改动提交到 Git。

### 9.6 常见问题 FAQ

| 问题 | 可能原因 | 解决方案 |
| --- | --- | --- |
| 替换后图标没变化 | 覆盖了 `drawable/`，但布局引用 `mipmap/` | 检查布局引用，必要时把资源放到正确目录 |
| SVG 导入失败 | 文件包含 `clipPath` / `mask` | 用 Illustrator 重新导出“简单路径”版或转成 PNG |
| 颜色不对 | 布局层设置了 `android:tint` | 同步修改布局里的 `tint`，或去掉 `tint` 直接在矢量里设色 |
| APK 体积暴增 | 导入了多套大图 | 改用 SVG/WebP，删除未使用的密度变体 |



## 10. 配置说明

### 10.1 网络权限

确保 `AndroidManifest.xml` 中包含网络权限:

```xml
<uses-permission android:name="android.permission.INTERNET" />
<uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />
```

### 10.2 应用配置

**应用 ID**: `com.example.dreamaichat_app`

如需修改，编辑 `app/build.gradle.kts`:
```kotlin
defaultConfig {
    applicationId = "com.yourcompany.dreamaichat_app"
    // ...
}
```

**版本信息**:
- Version Code: 1
- Version Name: "1.0"

### 10.3 签名配置（Release 构建）

1. **生成密钥库**
   ```bash
   keytool -genkey -v -keystore dreamai-release.jks -keyalg RSA -keysize 2048 -validity 10000 -alias dreamai
   ```

2. **配置签名**
   在 `app/build.gradle.kts` 中添加:
   ```kotlin
   android {
       signingConfigs {
           create("release") {
               storeFile = file("path/to/keystore.jks")
               storePassword = "your-store-password"
               keyAlias = "dreamai"
               keyPassword = "your-key-password"
           }
       }
       buildTypes {
           release {
               signingConfig = signingConfigs.getByName("release")
               // ...
           }
       }
   }
   ```



## 11. 考虑APP发布

### 11.1 代码混淆

在 `app/proguard-rules.pro` 中添加混淆规则:

```proguard
# Retrofit
-keepattributes Signature, InnerClasses
-keepattributes RuntimeVisibleAnnotations, RuntimeVisibleParameterAnnotations
-keepclassmembers,allowshrinking,allowobfuscation interface * {
    @retrofit2.http.* <methods>;
}

# Room
-keep class * extends androidx.room.RoomDatabase
-keep @androidx.room.Entity class *
```

### 11.2 资源优化

1. **移除未使用的资源**
   
   ```bash
   ./gradlew clean
   ```
   
2. **压缩图片资源**
   - 使用 WebP 格式
   - 使用适当的图片尺寸

### 11.3 性能优化

1. **启用 ProGuard**
   ```kotlin
   buildTypes {
       release {
           isMinifyEnabled = true
           proguardFiles(getDefaultProguardFile("proguard-android-optimize.txt"), "proguard-rules.pro")
       }
   }
   ```

2. **启用资源压缩**
   ```kotlin
   buildTypes {
       release {
           isShrinkResources = true
       }
   }
   ```



# 总结:

部署指南是我按实际开发流程, 根据我在开发调试APP过程中遇到的标志性部署, 构建节点来进行撰写. 是我在本客户端训练营中最大的思考实践文档, 供大家参考批评!
